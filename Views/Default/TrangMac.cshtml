
@{
    ViewBag.Title = "TrangMac";
    Layout = "~/Views/Shared/_HomeLayout.cshtml";
    var flashSaleItems = ViewBag.FlashSales as List<DoAn_web.Models.FlashSaleItem>;
}

<link href="~/Content/style_K/Style_TrangCon.css" rel="stylesheet" />
@*   breadcrumb     *@

@*banner*@
<link href="~/Content/style_K/Style_silder.css" rel="stylesheet" />
<section class="banner-section">
    <div class="slider">
        <div class="slides">
            <div class="slide" onclick="window.location.href=''">
                <img src="~/Content/img/Mac1.png" />
            </div>
            <div class="slide" onclick="window.location.href=''">
                <img src="~/Content/img/Mac2.png" />
            </div>
            <div class="slide" onclick="window.location.href=''">
                <img src="~/Content/img/Mac3.png" />
            </div>

        </div>

        @*Nút điều hướng*@
        <button class="prev">&#10094;</button>
        <button class="next">&#10095;</button>

        @*dau cham*@
        <div class="dots"></div>
    </div>
</section>
<script src="~/Content/js/js_banner.js"></script>

@* Best seller*@

<div class="product-list-container">

    <h2 class="list-title">Tất cả sản phẩm MacBook </h2>

    <div class="product-grid">

        @foreach (var product in Model)
        {
            // 2. LOGIC TÍNH TOÁN (Giống trang chủ)
            // Tìm xem sản phẩm này có đang sale không
            var saleItem = flashSaleItems != null ? flashSaleItems.FirstOrDefault(x => x.ProductID == product.ProductID) : null;

            decimal currentPrice = product.ProductPrice; // Giá mặc định
            int discountPercent = 0;

            if (saleItem != null)
            {
                currentPrice = saleItem.SalePrice; // Lấy giá sale
                if (product.ProductPrice > 0)
                {
                    discountPercent = (int)((product.ProductPrice - saleItem.SalePrice) / product.ProductPrice * 100);
                }
            }

            <div class="product-grid-item">
                <a class="home-product-link" href="@Url.Action("Details", "Product", new { id = product.ProductID })">

                    @* 3. THÊM position: relative ĐỂ LÀM KHUNG CHUẨN *@
                    <div class="home-product-card" style="position: relative;">

                        @* 4. HIỂN THỊ TEM GIẢM GIÁ (MÀU VÀNG) *@
                        @if (saleItem != null && discountPercent > 0)
                        {
                            <div style="position: absolute; top: 0; right: 0; background-color: #ffd839; color: #ee4d2d; font-weight: bold; font-size: 12px; padding: 4px 8px; border-bottom-left-radius: 5px; z-index: 5;">
                                -@discountPercent%
                            </div>
                        }

                        <img src="@Url.Content(product.ProductImage)" alt="@product.ProductName" class="home-product-image" />

                        <h5 class="home-product-name">@product.ProductName</h5>

                        @* 5. CẬP NHẬT HIỂN THỊ GIÁ *@
                        @if (saleItem != null)
                        {
                            // Có giảm giá: Hiện giá đỏ sale + Giá cũ gạch ngang
                            <div class="home-product-price">
                                <span style="color: #ee4d2d; font-weight: bold;">
                                    @String.Format("{0:N0}", currentPrice) đ
                                </span>
                                <br />
                                <span style="text-decoration: line-through; color: #999; font-size: 13px; font-weight: normal;">
                                    @String.Format("{0:N0}", product.ProductPrice) đ
                                </span>
                            </div>
                        }
                        else
                        {
                            // Không giảm giá: Hiện giá gốc
                            <p class="home-product-price">@String.Format("{0:N0}", product.ProductPrice) đ</p>
                        }

                    </div>
                </a>
            </div>
        }
    </div>
</div>